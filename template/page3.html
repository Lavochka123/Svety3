<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Страница 3</title>
  <link rel="stylesheet" href="/static/css/style.css">
</head>
<body class="{{ data.design }}">
  <div class="container">
    <!-- Можно вернуть "конверт", если хотите анимацию, но по условию "всё норм" – оставим. -->
    <div class="letter-content">
      <p>{{ data.page3 }}</p>
    </div>

    <div class="button-container" style="margin-top: 2rem;">
      <!-- Кнопка "Нет" (AJAX) и "Да" (ссылка на page4) -->
      <button class="button" onclick="handleResponse('no')">Нет</button>
      <a href="/invite/{{ data.id }}/page4" class="button">Да</a>
    </div>
  </div>

  <script>
    const chatId = "{{ data.chat_id }}";
    function handleResponse(response) {
      if (response === 'no') {
        fetch('/response', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({
            chat_id: chatId,
            response: 'Извини, не могу'
          })
        })
        .then(r => r.json())
        .then(resp => {
          if (resp.status === 'ok') {
            alert("Ваш отказ отправлен!");
          } else {
            alert("Ошибка: " + resp.message);
          }
        })
        .catch(err => {
          alert("Ошибка: " + err);
        });
      }
    }
  </script>
</body>
</html>
