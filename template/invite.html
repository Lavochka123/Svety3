<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Приглашение</title>
  <link rel="stylesheet" href="/static/css/style.css">
</head>
<body class="{{ data.design }}">
  <div class="container">
    <div class="envelope">
      <div class="heart heart1">❤️</div>
      <div class="heart heart2">❤️</div>
      <div class="heart heart3">❤️</div>
      <div class="envelope-flap"></div>
      <div class="envelope-body">
        <div class="letter-content">
          <!-- Три отдельных страницы -->
          <p>{{ data.page1 }}</p>
          <p>{{ data.page2 }}</p>
          <p>{{ data.page3 }}</p>
        </div>
      </div>
    </div>
    <div class="button-container">
      <button class="button" onclick="handleResponse('no')">Извини, не могу</button>
      <button class="button" onclick="handleResponse('yes')">Да, выберу время</button>
    </div>
  </div>

  <script>
    const chatId = "{{ data.chat_id }}";
    const inviteId = "{{ data.id }}";

    function handleResponse(response) {
      if (response === 'yes') {
        // Переход на страницу выбора времени
        window.location.href = '/choose_time?id=' + inviteId;
      } else {
        // AJAX-запрос для уведомления бота об отказе
        fetch('/response', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({
            chat_id: chatId,
            response: 'Извини, не могу'
          })
        })
        .then(res => res.json())
        .then(data => {
          if (data.status === "ok") {
            alert("Ваш ответ отправлен!");
          } else {
            alert("Ошибка при отправке ответа: " + data.message);
          }
        })
        .catch(error => {
          console.error('Ошибка:', error);
          alert("Ошибка при отправке ответа.");
        });
      }
    }
  </script>
</body>
</html>
